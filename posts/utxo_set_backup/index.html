<!DOCTYPE html>
<html lang="english" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How the UTXO Set Can Help Us Synchronize a Bitcoin Node | Explore Bitcoin and the Lightning Network</title>
<meta name="keywords" content="Nodes, BitcoinCore, Layer 1, Bitcoin-cli">
<meta name="description" content="We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (initial block download) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.">
<meta name="author" content="Pol Espinasa">
<link rel="canonical" href="https://pesvi.xyz/posts/utxo_set_backup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://pesvi.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://pesvi.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://pesvi.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://pesvi.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://pesvi.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="english" href="https://pesvi.xyz/posts/utxo_set_backup/">
<link rel="alternate" hreflang="catal√†" href="https://pesvi.xyz/catal%C3%A0/posts/utxo_set_backup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-KXYVPZQE88"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-KXYVPZQE88');
        }
      </script><meta property="og:url" content="https://pesvi.xyz/posts/utxo_set_backup/">
  <meta property="og:site_name" content="Explore Bitcoin and the Lightning Network">
  <meta property="og:title" content="How the UTXO Set Can Help Us Synchronize a Bitcoin Node">
  <meta property="og:description" content="We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (initial block download) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.">
  <meta property="og:locale" content="english">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-02-13T00:00:00+00:00">
    <meta property="article:tag" content="Nodes">
    <meta property="article:tag" content="BitcoinCore">
    <meta property="article:tag" content="Layer 1">
    <meta property="article:tag" content="Bitcoin-Cli">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How the UTXO Set Can Help Us Synchronize a Bitcoin Node">
<meta name="twitter:description" content="We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (initial block download) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://pesvi.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How the UTXO Set Can Help Us Synchronize a Bitcoin Node",
      "item": "https://pesvi.xyz/posts/utxo_set_backup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How the UTXO Set Can Help Us Synchronize a Bitcoin Node",
  "name": "How the UTXO Set Can Help Us Synchronize a Bitcoin Node",
  "description": "We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (initial block download) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.\n",
  "keywords": [
    "Nodes", "BitcoinCore", "Layer 1", "Bitcoin-cli"
  ],
  "articleBody": "We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (initial block download) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.\nIn this post we will see how we can advance to this situation and how we can take measures to be able, in the future, to synchronize our nodes quickly.\n‚ö†Ô∏è CLICK BAIT The node does not synchronize faster, but it does allow you to use it almost instantly using background synchronization!\nFirst ideas There are some ways to speed up the IBD process by sacrificing security by not verifying the blockchain. Although some are not recommended, they are explained in this first section.\nAssume valid The assumevalid parameter in Bitcoin Core allows you to specify the node that up to a certain block height you do not want transactions to be verified and assumes that they are valid. Therefore, the process is simplified to just validating that the blocks are built correctly. Using this parameter during the initial synchronization greatly speeds up the process because the main factor that slows down the synchronization is the scripts verification.\nHowever, with assumevalid we still need to download the whole chain to be able to use the node. Yes, it will go faster, but we still have to unload it until we reach the current status.\nüí° Information! Bitcoin Core has assumevalid enabled by default at a pre-release block height.\nCopy the blockchain Another way to speed up the IBD process is to copy the files from one node to another. Specifically, you would copy the files from the blocks and chainstate directories.\nThis procedure may have some problems. To begin with, downloading the files from an unknown source is not recommended. If you have to carry out this procedure, do it from a node that you control. There may also be incompatibilities between versions of the node software if the way you create and deploy these files is different.\nWe discard this option because keeping redundant copies of the blockchain is not the optimal way to do it.\nHow do we do it then? ü§î Let‚Äôs imagine that we could save a checkpoint representing the status of the chain at a certain block height. What information would this checkpoint have to contain? To verify transactions and spend bitcoins what we need is to know the unspent transactions in the present. Who keeps a record of these unspent transactions? The UTXO set!\nThe UTXO set is a database that represents the current status of unspent transaction outputs (UTXO). With the UTXO set we can verify that a transaction is valid without looking at the chain, since the entries of these have to spend unspent transaction outputs (UTXOs) and create new ones. In simpler words, it is a record that tells where the bitcoins are at this very moment.\nHow do we use the UTXO set to synchronize the node? If we have the current status of the chain, that is, the coins (UTXOs) that can be spent, we can make and verify transactions without problems. This works because ALL the bitcoins we have available to spend are represented in the UTXO set.\nIf we only need the UTXO set to make and verify transactions, can we simply load it at a very recent point, start using Bitcoin and, in the meantime, download the previous blocks?\nYes, the previous blocks can be downloaded in the background without affecting the wallets‚Äô ability to show the balance and spend funds.\nüí° Information! This is the reason why the ‚Äúpruned‚Äù nodes can also verify all the information, they only need the UTXO set!\nStep 1. Load a copy of the UTXO set Let‚Äôs suppose that we have a backup of the UTXO set in a file: utxo.dat. This backup of the UTXO set is made at block 840.000, therefore, when we import it, our node will be set to 840.000 almost instantly. To do this we can use the command that introduces Bitcoin Core to version 26.0 ‚Äúloadtxoutset‚Äù.\nLet‚Äôs start from the beginning. We start the Bitcoin node executing, as usual, the bitcoind binary. We will see that at the beginning it performs a presynchronization of the headers and then it synchronizes them. We have to wait for the synchronization of the headers to finish.\nPresynchronization:\n2025-02-18T10:53:47Z Pre-synchronizing blockheaders, height: 10000 (~1.18%) 2025-02-18T10:53:48Z Pre-synchronizing blockheaders, height: 12000 (~1.42%) 2025-02-18T10:53:49Z Pre-synchronizing blockheaders, height: 14000 (~1.66%) 2025-02-18T10:53:50Z Pre-synchronizing blockheaders, height: 16000 (~1.90%) 2025-02-18T10:53:50Z Pre-synchronizing blockheaders, height: 18000 (~2.14%) 2025-02-18T10:53:51Z Pre-synchronizing blockheaders, height: 20000 (~2.38%) 2025-02-18T10:53:52Z Pre-synchronizing blockheaders, height: 22000 (~2.63%) 2025-02-18T10:53:53Z Pre-synchronizing blockheaders, height: 24000 (~2.88%) 2025-02-18T10:53:53Z Pre-synchronizing blockheaders, height: 26000 (~3.13%) 2025-02-18T10:53:54Z Pre-synchronizing blockheaders, height: 28000 (~3.38%) 2025-02-18T10:53:55Z Pre-synchronizing blockheaders, height: 30000 (~3.62%) 2025-02-18T10:53:56Z Pre-synchronizing blockheaders, height: 32000 (~3.86%) Synchronization:\n2025-02-18T11:07:39Z Synchronizing blockheaders, height: 59379 (~7.13%) 2025-02-18T11:07:40Z Synchronizing blockheaders, height: 61379 (~7.37%) 2025-02-18T11:07:42Z Synchronizing blockheaders, height: 63379 (~7.60%) 2025-02-18T11:07:43Z Synchronizing blockheaders, height: 65379 (~7.84%) 2025-02-18T11:07:46Z Synchronizing blockheaders, height: 67379 (~8.07%) 2025-02-18T11:07:48Z Synchronizing blockheaders, height: 69379 (~8.30%) 2025-02-18T11:07:49Z Synchronizing blockheaders, height: 71379 (~8.53%) 2025-02-18T11:07:54Z Synchronizing blockheaders, height: 73379 (~8.76%) 2025-02-18T11:07:56Z Synchronizing blockheaders, height: 75379 (~9.00%) 2025-02-18T11:07:57Z Synchronizing blockheaders, height: 77379 (~9.23%) 2025-02-18T11:07:59Z Synchronizing blockheaders, height: 79379 (~9.47%) 2025-02-18T11:08:01Z Synchronizing blockheaders, height: 81379 (~9.70%) Once the headers are synchronized, if we execute bitcoin-cli getblockchaininfo we will see that it starts to synchronize the blocks as usual:\n$ bitcoin-cli getblockchaininfo { \"chain\": \"main\", \"blocks\": 24503, \"headers\": 884325, ... \"verificationprogress\": 2.110628750476074e-05, \"initialblockdownload\": true, \"chainwork\": \"00000000000000000000000000000000000000000000000000005fb85fb85fb8\", \"size_on_disk\": 6748282, \"pruned\": false, } Once we have the node running and synchronizing we can import the UTXO set with the instruction bitcoin-cli -rpcclienttimout=0 loadtxoutset utxo.dat. Where utxo.dat is our backup of the UTXO set. ( I recommend to place the utxo.dat folder in the directory where you are saving the node data, by default it is ~.bitcoin).\nBefore doing so it is recommended to use bitcoin-cli setnetworkactive false. This instruction improves performance, as it stops the networking. It must be re-enabled at the end of the download. (This is optional, if it is not done, it will work the same but with worse performance).\n‚ö†Ô∏è Warning. It is important to specify -rpcclienttimout=0 to prevent the communication from being timed out, since the process can take a few minutes.\nIt is common for the terminal to get stuck without acting like this: While the command seems to remain stuck, you can see in the bitcoind logs how the node continues to synchronize normally and, eventually, you can see logs showing that it is loading the coins from the UTXO set. Once finished we will see that the RPC command confirms that we have imported the data:\nbitcoin-cli -rpcclienttimeout=0 loadtxoutset utxo.dat { \"coins_loaded\": 176948713, \"tip_hash\": \"0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5\", \"base_height\": 840000, \"path\": \"/home/sliv3r/Escritorio/blockchain/utxo.dat\" } If we look at the logs of bitcoind, we can see how it has updated the chainstate (the status of the chain) to the 840,000 block:\n2025-02-18T14:55:18Z UpdateTip: new best=000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6 height=190942 version=0x00000001 log2_work=68.448132 tx=5332360 date='2012-07-27T01:22:01Z' progress=0.004564 cache=264.9MiB(2106915txo) 2025-02-18T14:55:18Z [snapshot] validated snapshot (0 MB) 2025-02-18T14:55:18Z [snapshot] successfully activated snapshot 0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5 2025-02-18T14:55:18Z [snapshot] (0 MB) 2025-02-18T14:55:18Z Opening LevelDB in /home/sliv3r/Escritorio/blockchain/chainstate 2025-02-18T14:55:18Z Opened LevelDB successfully 2025-02-18T14:55:18Z Using obfuscation key for /home/sliv3r/Escritorio/blockchain/chainstate: d06729b36c1332a2 2025-02-18T14:55:18Z [Chainstate [ibd] @ height 190942 (000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6)] resized coinsdb cache to 0.4 MiB 2025-02-18T14:55:18Z [Chainstate [ibd] @ height 190942 (000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6)] resized coinstip cache to 22.0 MiB 2025-02-18T14:55:18Z Cache size (277731616) exceeds total space (23068672) 2025-02-18T14:55:22Z Opening LevelDB in /home/sliv3r/Escritorio/blockchain/chainstate_snapshot 2025-02-18T14:55:22Z Opened LevelDB successfully 2025-02-18T14:55:22Z Using obfuscation key for /home/sliv3r/Escritorio/blockchain/chainstate_snapshot: ffaa87a9790b88bb 2025-02-18T14:55:22Z [Chainstate [snapshot] @ height 840000 (0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5)] resized coinsdb cache to 7.6 MiB 2025-02-18T14:55:22Z [Chainstate [snapshot] @ height 840000 (0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5)] resized coinstip cache to 418.0 MiB And if we execute the command bitcoin-cli getblockchaininfo we will be able to see how effectively we have the node synchronized to the 840.000 block:\nbitcoin-cli getblockchaininfo { \"chain\": \"main\", \"blocks\": 840077, \"headers\": 884327, \"bestblockhash\": \"000000000000000000018bd4948d21337c98ea27cd5586393a31c644ce9ab1ce\", \"bits\": \"17034219\", \"target\": \"0000000000000000000342190000000000000000000000000000000000000000\", \"difficulty\": 86388558925171.02, \"time\": 1713621243, \"mediantime\": 1713616671, \"verificationprogress\": 0.8484856035034852, \"initialblockdownload\": true, \"chainwork\": \"000000000000000000000000000000000000000075537cab1a1b8a216234e13a\", \"size_on_disk\": 3395515205, \"pruned\": false, \"warnings\": [ \"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\" ] } If you have disabled the p2p network, re-enable it with bitcoin-cli setnetworkactive true. We look again at the bitcoind logs and see that now it is synchronizing the blocks between the 840,000 and the chain tip:\n2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000001caffc952e7de3b1c8b2f2d044e8e69955000ca6fb9e4 height=840436 version=0x20e00000 log2_work=94.879663 tx=993054314 date='2024-04-23T01:53:38Z' progress=0.849873 cache=458.5MiB(2943813txo) 2025-02-18T14:58:36Z UpdateTip: new best=000000000000000000014797e1aa0867732005d6cb11fad392e35fbc81f552bd height=840437 version=0x20000000 log2_work=94.879678 tx=993060398 date='2024-04-23T02:05:34Z' progress=0.849878 cache=459.1MiB(2947040txo) 2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000002a0658cf7d5af3fadb3469df23e97de849a32991c0545 height=840438 version=0x3fffe000 log2_work=94.879693 tx=993066120 date='2024-04-23T02:13:23Z' progress=0.849883 cache=459.8MiB(2951620txo) 2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000002349473de1b8f66f12b65cdeb870c211927865c856e41 height=840439 version=0x3fff0000 log2_work=94.879707 tx=993071846 date='2024-04-23T02:16:31Z' progress=0.849888 cache=460.5MiB(2956234txo) 2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000000c6b9fd50913cf6d3d34536c06c1a029ba6c844cc8033 height=840440 version=0x20a00000 log2_work=94.879722 tx=993077310 date='2024-04-23T02:17:04Z' progress=0.849893 cache=461.2MiB(2961405txo) 2025-02-18T14:58:36Z UpdateTip: new best=000000000000000000033c2f66f551e44aea785f91a902b321c38703a158ed3a height=840441 version=0x20a00000 log2_work=94.879737 tx=993083167 date='2024-04-23T02:20:03Z' progress=0.849898 cache=461.9MiB(2965605txo) 2025-02-18T14 üí° The current block in the chain, i.e. the last block in the chain with the most proof of work, is what we call the chain tip.\nOnce the node finishes synchronizing from block 840.000 to the current tip, in this case block 884.365, we can see how it starts synchronizing the node from 0. It can be easily identified, since in the logs it is marked as background validation.\n2025-02-18T20:18:41Z [background validation] UpdateTip: new best=000000000000001db5a1515a5f8534c941b1628f60466e6b709b3b320254afff height=208000 version=0x00000001 log2_work=69.023342 tx=8883319 date='2012-11-15T05:17:32Z' progress=0.007602 cache=58.2MiB(460376txo) 2025-02-18T20:19:04Z [background validation] UpdateTip: new best=000000000000048b95347e83192f69cf0366076336c639f9b7228e9ba171342e height=210000 version=0x00000002 log2_work=69.091539 tx=9344662 date='2012-11-28T15:24:38Z' progress=0.007996 cache=94.6MiB(728202txo) 2025-02-18T20:19:40Z [background validation] UpdateTip: new best=00000000000003d906e4131c39f7655b72df40146d2967f5d75113a09610de61 height=212000 version=0x00000002 log2_work=69.157547 tx=9819223 date='2012-12-13T01:33:36Z' progress=0.008403 cache=117.6MiB(927414txo) 2025-02-18T20:19:41Z Saw new header hash=000000000000000000019940b918fed6453c7afa80e03f1d837d1fdd8b31a8b9 height=884366 2025-02-18T20:19:45Z UpdateTip: new best=000000000000000000019940b918fed6453c7afa80e03f1d837d1fdd8b31a8b9 height=884366 version=0x2002a000 log2_work=95.452620 tx=1156361979 date='2025-02-18T20:19:40Z' progress=1.000000 cache=2.7MiB(19061txo) Looking at the previous logs we can see that, although it is verifying very old blocks such as 210.000, when a new block appears, 884.366 in this case, it immediately updates the tip of its chain and then continues with the verification of old blocks.\nConclusions and cautions With this process the node reaches a state where it is usable to consult the balance and create transactions much faster than synchronizing the whole chain. In a normal laptop, this whole process has taken me no more than 2 hours which is already a big improvement compared to the days that a normal synchronization can take.\n‚ö†Ô∏è Warning. It is very important not to download the UTXO set from an unknown and untrusted source. The risk is very high, since a false representation of the UTXO set can make you believe that you have been paid when it is not true. You can be tricked and robbed.\nBitcoin Core tries to prevent this by restricting the import of the UTXO set to a block defined in the latest release (the 880,000 block as of this post) and verifying that the UTXO set is correct and has not been tampered. Skipping this check is not difficult and allows more experienced users to speed up this process even more. This post will not explain how to do it so as not to expose the readers to a possible attack.\n‚ö†Ô∏è Warning. When the 1st part of the post was written the block of the last release was the 840.000 and not the 880.000, that‚Äôs why the guide is about the 840.000.\nHow to create or obtain a backup of the UTXO set? The easiest way to get a backup of the UTXO set is with the magnet link: magnet:?xt=urn:btih:559bd78170502971e15e97d7572e4c824f033492\u0026dn=utxo-880000.dat\u0026tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969.\nAs I said before, you should avoid downloading the UTXO set from unknown sources (don‚Äôt trust me!), but well, there are different mechanisms to verify that the copy provided by this magnet link is correct:\nThe link provided in the PR Bitcoin Core which introduces the parameters to the code. You can validate the hash of the copy with: shasum -a 256 utxo-880000.dat the result should give 43b3b1ad6e1005ffc0ff49514d0ffcc3e3e3ce671cc8d02da7fa7bac5405f89de4. How do we generate our own backup? To do this we need a node already synchronized to a block height higher than the backup. In this case higher than 880.000.\n‚ö†Ô∏è Warning. The node cannot be pruned at a lower height than the height of the block on which the backup is made.\nUsing the instruction bitcoin-cli -rpcclienttimeout=0 dumptxoutset utxo.dat rollback. By default this command will backup the UTXO set to the ~\\.bitcoin directory. This process may take a little while, because the node is getting desynchronized until it reaches the block of the last valid checkpoint.\nHere you can see a video of how a node is being desynchronized in this process.\nAgain you can validate that the backup is correct with the hash of the file:\nshasum -a 256 utxo-880000.dat 43b3b1ad6e1005ffc0ff49514d0ffcc3e3ce671cc8d02da7fa7bac5405f89de4 Hey! Enjoy synchronizing nodes at the speed of light!!! AND REMEMBER ‚Äî\u003e DON‚ÄôT TRUST, VERIFY. IF YOU DON‚ÄôT RUN YOUR OWN NODE YOU ARE NOT USING BITCOIN WITHOUT A ‚ÄúTRUSTED‚Äù MIDLEMAN\n",
  "wordCount" : "2162",
  "inLanguage": "english",
  "datePublished": "2025-02-13T00:00:00Z",
  "dateModified": "2025-02-13T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Pol Espinasa"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://pesvi.xyz/posts/utxo_set_backup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Explore Bitcoin and the Lightning Network",
    "logo": {
      "@type": "ImageObject",
      "url": "https://pesvi.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://pesvi.xyz/" accesskey="h" title="Explore Bitcoin and the Lightning Network (Alt + H)">Explore Bitcoin and the Lightning Network</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://pesvi.xyz/catal%C3%A0/" title="Catal√†"
                            aria-label="Catal√†">Catal√†</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://pesvi.xyz/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://pesvi.xyz/pullrequests/" title="PRs">
                    <span>PRs</span>
                </a>
            </li>
            <li>
                <a href="https://pesvi.xyz/publications/" title="Publications">
                    <span>Publications</span>
                </a>
            </li>
            <li>
                <a href="https://pesvi.xyz/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      How the UTXO Set Can Help Us Synchronize a Bitcoin Node
    </h1>
    <div class="post-meta"><span title='2025-02-13 00:00:00 +0000 UTC'>February 13, 2025</span>&nbsp;¬∑&nbsp;11 min&nbsp;¬∑&nbsp;Pol Espinasa&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://pesvi.xyz/catal%C3%A0/posts/utxo_set_backup/">Catal√†</a>
    </li>
</ul>

</div>
  </header> 
  <div class="post-content"><p>We all have encountered at some point that our Bitcoin node stops working, the raspberry fails, the disk dies, or we simply need the disk for other purposes and we end up without a Bitcoin node. In the future when we want to set up a node again we find that we have to go through the IBD (<em>initial block download</em>) process to synchronize the blockchain. A heavy process, that can last in many cases days and that prevents us to use the node and to connect the wallets until the node is completely synchronized.</p>
<p>In this post we will see how we can advance to this situation and how we can take measures to be able, in the future, to synchronize our nodes quickly.</p>
<blockquote>
<p>&#x26a0;&#xfe0f; <strong>CLICK BAIT</strong>
<em>The node does not synchronize faster, but it does allow you to use it almost instantly using background synchronization!</em></p>
</blockquote>
<h2 id="first-ideas">First ideas<a hidden class="anchor" aria-hidden="true" href="#first-ideas">#</a></h2>
<p>There are some ways to speed up the IBD process by sacrificing security by not verifying the blockchain. Although some are not recommended, they are explained in this first section.</p>
<h3 id="assume-valid">Assume valid<a hidden class="anchor" aria-hidden="true" href="#assume-valid">#</a></h3>
<p>The <code>assumevalid</code> parameter in Bitcoin Core allows you to specify the node that up to a certain block height you do not want transactions to be verified and assumes that they are valid. Therefore, the process is simplified to just validating that the blocks are built correctly. Using this parameter during the initial synchronization greatly speeds up the process because the main factor that slows down the synchronization is the scripts verification.</p>
<p>However, with <code>assumevalid</code> we still need to download the whole chain to be able to use the node. Yes, it will go faster, but we still have to unload it until we reach the current status.</p>
<blockquote>
<p>&#x1f4a1; <strong>Information!</strong>
<em>Bitcoin Core has <code>assumevalid</code> enabled by default at a pre-release block height.</em></p>
</blockquote>
<h3 id="copy-the-blockchain">Copy the blockchain<a hidden class="anchor" aria-hidden="true" href="#copy-the-blockchain">#</a></h3>
<p>Another way to speed up the IBD process is to copy the files from one node to another. Specifically, you would copy the files from the <code>blocks</code> and <code>chainstate</code> directories.</p>
<p>This procedure may have some problems. To begin with, downloading the files from an unknown source is not recommended. If you have to carry out this procedure, do it from a node that you control. There may also be incompatibilities between versions of the node software if the way you create and deploy these files is different.</p>
<p>We discard this option because keeping redundant copies of the blockchain is not the optimal way to do it.</p>
<h2 id="how-do-we-do-it-then-">How do we do it then? ü§î<a hidden class="anchor" aria-hidden="true" href="#how-do-we-do-it-then-">#</a></h2>
<p>Let&rsquo;s imagine that we could save a <em>checkpoint</em> representing the status of the chain at a certain block height. What information would this <em>checkpoint</em> have to contain? To verify transactions and spend bitcoins what we need is to know the unspent transactions in the present. Who keeps a record of these unspent transactions? The <strong>UTXO set</strong>!</p>
<p>The <strong>UTXO set</strong> is a database that represents the current status of unspent transaction outputs (UTXO). With the <strong>UTXO set</strong> we can verify that a transaction is valid without looking at the chain, since the entries of these have to spend <em>unspent transaction outputs</em> (UTXOs) and create new ones. In simpler words, it is a record that tells where the bitcoins are at this very moment.</p>
<h3 id="how-do-we-use-the-utxo-set-to-synchronize-the-node">How do we use the UTXO set to synchronize the node?<a hidden class="anchor" aria-hidden="true" href="#how-do-we-use-the-utxo-set-to-synchronize-the-node">#</a></h3>
<p>If we have the current status of the chain, that is, the coins (UTXOs) that can be spent, we can make and verify transactions without problems. This works because <strong>ALL</strong> the bitcoins we have available to spend are represented in the <strong>UTXO set</strong>.</p>
<p>If we only need the <strong>UTXO set</strong> to make and verify transactions, can we simply load it at a very recent point, start using Bitcoin and, in the meantime, download the previous blocks?</p>
<p>Yes, the previous blocks can be downloaded in the background without affecting the wallets&rsquo; ability to show the balance and spend funds.</p>
<blockquote>
<p>&#x1f4a1; <strong>Information!</strong>
<em>This is the reason why the ‚Äúpruned‚Äù nodes can also verify all the information, they only need the <strong>UTXO set</strong>!</em></p>
</blockquote>
<h3 id="step-1-load-a-copy-of-the-utxo-set">Step 1. Load a copy of the UTXO set<a hidden class="anchor" aria-hidden="true" href="#step-1-load-a-copy-of-the-utxo-set">#</a></h3>
<p>Let&rsquo;s suppose that we have a backup of the <strong>UTXO set</strong> in a file: <code>utxo.dat</code>. This backup of the <strong>UTXO set</strong> is made at block <code>840.000</code>, therefore, when we import it, our node will be set to <code>840.000</code> almost instantly.
To do this we can use the <a href="https://bitcoincore.org/en/doc/28.0.0/rpc/blockchain/loadtxoutset/">command that introduces Bitcoin Core to version 26.0 ‚Äúloadtxoutset‚Äù</a>.</p>
<p>Let&rsquo;s start from the beginning. We start the Bitcoin node executing, as usual, the <code>bitcoind</code> binary. We will see that at the beginning it performs a presynchronization of the <em>headers</em> and then it synchronizes them. We have to wait for the synchronization of the <em>headers</em> to finish.</p>
<p>Presynchronization:</p>
<pre tabindex="0"><code>2025-02-18T10:53:47Z Pre-synchronizing blockheaders, height: 10000 (~1.18%)
2025-02-18T10:53:48Z Pre-synchronizing blockheaders, height: 12000 (~1.42%)
2025-02-18T10:53:49Z Pre-synchronizing blockheaders, height: 14000 (~1.66%)
2025-02-18T10:53:50Z Pre-synchronizing blockheaders, height: 16000 (~1.90%)
2025-02-18T10:53:50Z Pre-synchronizing blockheaders, height: 18000 (~2.14%)
2025-02-18T10:53:51Z Pre-synchronizing blockheaders, height: 20000 (~2.38%)
2025-02-18T10:53:52Z Pre-synchronizing blockheaders, height: 22000 (~2.63%)
2025-02-18T10:53:53Z Pre-synchronizing blockheaders, height: 24000 (~2.88%)
2025-02-18T10:53:53Z Pre-synchronizing blockheaders, height: 26000 (~3.13%)
2025-02-18T10:53:54Z Pre-synchronizing blockheaders, height: 28000 (~3.38%)
2025-02-18T10:53:55Z Pre-synchronizing blockheaders, height: 30000 (~3.62%)
2025-02-18T10:53:56Z Pre-synchronizing blockheaders, height: 32000 (~3.86%)
</code></pre><p>Synchronization:</p>
<pre tabindex="0"><code>2025-02-18T11:07:39Z Synchronizing blockheaders, height: 59379 (~7.13%)
2025-02-18T11:07:40Z Synchronizing blockheaders, height: 61379 (~7.37%)
2025-02-18T11:07:42Z Synchronizing blockheaders, height: 63379 (~7.60%)
2025-02-18T11:07:43Z Synchronizing blockheaders, height: 65379 (~7.84%)
2025-02-18T11:07:46Z Synchronizing blockheaders, height: 67379 (~8.07%)
2025-02-18T11:07:48Z Synchronizing blockheaders, height: 69379 (~8.30%)
2025-02-18T11:07:49Z Synchronizing blockheaders, height: 71379 (~8.53%)
2025-02-18T11:07:54Z Synchronizing blockheaders, height: 73379 (~8.76%)
2025-02-18T11:07:56Z Synchronizing blockheaders, height: 75379 (~9.00%)
2025-02-18T11:07:57Z Synchronizing blockheaders, height: 77379 (~9.23%)
2025-02-18T11:07:59Z Synchronizing blockheaders, height: 79379 (~9.47%)
2025-02-18T11:08:01Z Synchronizing blockheaders, height: 81379 (~9.70%)
</code></pre><p>Once the <em>headers</em> are synchronized, if we execute <code>bitcoin-cli getblockchaininfo</code> we will see that it starts to synchronize the blocks as usual:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ bitcoin-cli getblockchaininfo
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;chain&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;blocks&#34;</span>: 24503,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;headers&#34;</span>: 884325,
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;verificationprogress&#34;</span>: 2.110628750476074e-05,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;initialblockdownload&#34;</span>: true,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;chainwork&#34;</span>: <span style="color:#e6db74">&#34;00000000000000000000000000000000000000000000000000005fb85fb85fb8&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;size_on_disk&#34;</span>: 6748282,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;pruned&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Once we have the node running and synchronizing we can import the <strong>UTXO set</strong> with the instruction <code>bitcoin-cli -rpcclienttimout=0 loadtxoutset utxo.dat</code>. Where <code>utxo.dat</code> is our backup of the <strong>UTXO set</strong>. ( I recommend to place the <code>utxo.dat</code> folder in the directory where you are saving the node data, by default it is <code>~.bitcoin</code>).</p>
<p>Before doing so it is recommended to use <code>bitcoin-cli setnetworkactive false</code>. This instruction improves performance, as it stops the networking. It must be re-enabled at the end of the download. (This is optional, if it is not done, it will work the same but with worse performance).</p>
<blockquote>
<p>&#x26a0;&#xfe0f; <strong>Warning</strong>.
<em>It is important to specify <code>-rpcclienttimout=0</code> to prevent the communication from being timed out, since the process can take a few minutes.</em></p>
</blockquote>
<p>It is common for the terminal to get stuck without acting like this:
<img loading="lazy" src="/assumetxoutset/txoutset_timout.png#center"></p>
<p>While the command seems to remain stuck, you can see in the <code>bitcoind</code> logs how the node continues to synchronize normally and, eventually, you can see logs showing that it is loading the <em>coins</em> from the <strong>UTXO set</strong>.
<img loading="lazy" src="/assumetxoutset/load_coins.png#center"></p>
<p>Once finished we will see that the RPC command confirms that we have imported the data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bitcoin-cli -rpcclienttimeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> loadtxoutset utxo.dat 
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;coins_loaded&#34;</span>: 176948713,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;tip_hash&#34;</span>: <span style="color:#e6db74">&#34;0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;base_height&#34;</span>: 840000,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/home/sliv3r/Escritorio/blockchain/utxo.dat&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>If we look at the logs of <code>bitcoind</code>, we can see how it has updated the <code>chainstate</code> (the status of the chain) to the <code>840,000</code> block:</p>
<pre tabindex="0"><code>2025-02-18T14:55:18Z UpdateTip: new best=000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6 height=190942 version=0x00000001 log2_work=68.448132 tx=5332360 date=&#39;2012-07-27T01:22:01Z&#39; progress=0.004564 cache=264.9MiB(2106915txo)
2025-02-18T14:55:18Z [snapshot] validated snapshot (0 MB)
2025-02-18T14:55:18Z [snapshot] successfully activated snapshot 0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5
2025-02-18T14:55:18Z [snapshot] (0 MB)
2025-02-18T14:55:18Z Opening LevelDB in /home/sliv3r/Escritorio/blockchain/chainstate
2025-02-18T14:55:18Z Opened LevelDB successfully
2025-02-18T14:55:18Z Using obfuscation key for /home/sliv3r/Escritorio/blockchain/chainstate: d06729b36c1332a2
2025-02-18T14:55:18Z [Chainstate [ibd] @ height 190942 (000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6)] resized coinsdb cache to 0.4 MiB
2025-02-18T14:55:18Z [Chainstate [ibd] @ height 190942 (000000000000085b8326215f4334716986036cd7f22b474b4bb1d30e44abc7c6)] resized coinstip cache to 22.0 MiB
2025-02-18T14:55:18Z Cache size (277731616) exceeds total space (23068672)
2025-02-18T14:55:22Z Opening LevelDB in /home/sliv3r/Escritorio/blockchain/chainstate_snapshot
2025-02-18T14:55:22Z Opened LevelDB successfully
2025-02-18T14:55:22Z Using obfuscation key for /home/sliv3r/Escritorio/blockchain/chainstate_snapshot: ffaa87a9790b88bb
2025-02-18T14:55:22Z [Chainstate [snapshot] @ height 840000 (0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5)] resized coinsdb cache to 7.6 MiB
2025-02-18T14:55:22Z [Chainstate [snapshot] @ height 840000 (0000000000000000000320283a032748cef8227873ff4872689bf23f1cda83a5)] resized coinstip cache to 418.0 MiB
</code></pre><p>And if we execute the command <code>bitcoin-cli getblockchaininfo</code> we will be able to see how effectively we have the node synchronized to the <code>840.000</code> block:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bitcoin-cli getblockchaininfo
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;chain&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;blocks&#34;</span>: 840077,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;headers&#34;</span>: 884327,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;bestblockhash&#34;</span>: <span style="color:#e6db74">&#34;000000000000000000018bd4948d21337c98ea27cd5586393a31c644ce9ab1ce&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;bits&#34;</span>: <span style="color:#e6db74">&#34;17034219&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;0000000000000000000342190000000000000000000000000000000000000000&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;difficulty&#34;</span>: 86388558925171.02,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;time&#34;</span>: 1713621243,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;mediantime&#34;</span>: 1713616671,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;verificationprogress&#34;</span>: 0.8484856035034852,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;initialblockdownload&#34;</span>: true,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;chainwork&#34;</span>: <span style="color:#e6db74">&#34;000000000000000000000000000000000000000075537cab1a1b8a216234e13a&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;size_on_disk&#34;</span>: 3395515205,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;pruned&#34;</span>: false,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;warnings&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;This is a pre-release test build - use at your own risk - do not use for mining or merchant applications&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>If you have disabled the p2p network, re-enable it with <code>bitcoin-cli setnetworkactive true</code>.
We look again at the <code>bitcoind</code> logs and see that now it is synchronizing the blocks between the <code>840,000</code> and the chain tip:</p>
<pre tabindex="0"><code>2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000001caffc952e7de3b1c8b2f2d044e8e69955000ca6fb9e4 height=840436 version=0x20e00000 log2_work=94.879663 tx=993054314 date=&#39;2024-04-23T01:53:38Z&#39; progress=0.849873 cache=458.5MiB(2943813txo)
2025-02-18T14:58:36Z UpdateTip: new best=000000000000000000014797e1aa0867732005d6cb11fad392e35fbc81f552bd height=840437 version=0x20000000 log2_work=94.879678 tx=993060398 date=&#39;2024-04-23T02:05:34Z&#39; progress=0.849878 cache=459.1MiB(2947040txo)
2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000002a0658cf7d5af3fadb3469df23e97de849a32991c0545 height=840438 version=0x3fffe000 log2_work=94.879693 tx=993066120 date=&#39;2024-04-23T02:13:23Z&#39; progress=0.849883 cache=459.8MiB(2951620txo)
2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000002349473de1b8f66f12b65cdeb870c211927865c856e41 height=840439 version=0x3fff0000 log2_work=94.879707 tx=993071846 date=&#39;2024-04-23T02:16:31Z&#39; progress=0.849888 cache=460.5MiB(2956234txo)
2025-02-18T14:58:36Z UpdateTip: new best=00000000000000000000c6b9fd50913cf6d3d34536c06c1a029ba6c844cc8033 height=840440 version=0x20a00000 log2_work=94.879722 tx=993077310 date=&#39;2024-04-23T02:17:04Z&#39; progress=0.849893 cache=461.2MiB(2961405txo)
2025-02-18T14:58:36Z UpdateTip: new best=000000000000000000033c2f66f551e44aea785f91a902b321c38703a158ed3a height=840441 version=0x20a00000 log2_work=94.879737 tx=993083167 date=&#39;2024-04-23T02:20:03Z&#39; progress=0.849898 cache=461.9MiB(2965605txo)
2025-02-18T14
</code></pre><blockquote>
<p>&#x1f4a1; The current block in the chain, i.e. the last block in the chain with the most proof of work, is what we call the chain tip.</p>
</blockquote>
<p>Once the node finishes synchronizing from block <code>840.000</code> to the current tip, in this case block <code>884.365</code>, we can see how it starts synchronizing the node from 0. It can be easily identified, since in the logs it is marked as <em>background validation</em>.</p>
<pre tabindex="0"><code>2025-02-18T20:18:41Z [background validation] UpdateTip: new best=000000000000001db5a1515a5f8534c941b1628f60466e6b709b3b320254afff height=208000 version=0x00000001 log2_work=69.023342 tx=8883319 date=&#39;2012-11-15T05:17:32Z&#39; progress=0.007602 cache=58.2MiB(460376txo)
2025-02-18T20:19:04Z [background validation] UpdateTip: new best=000000000000048b95347e83192f69cf0366076336c639f9b7228e9ba171342e height=210000 version=0x00000002 log2_work=69.091539 tx=9344662 date=&#39;2012-11-28T15:24:38Z&#39; progress=0.007996 cache=94.6MiB(728202txo)
2025-02-18T20:19:40Z [background validation] UpdateTip: new best=00000000000003d906e4131c39f7655b72df40146d2967f5d75113a09610de61 height=212000 version=0x00000002 log2_work=69.157547 tx=9819223 date=&#39;2012-12-13T01:33:36Z&#39; progress=0.008403 cache=117.6MiB(927414txo)
2025-02-18T20:19:41Z Saw new header hash=000000000000000000019940b918fed6453c7afa80e03f1d837d1fdd8b31a8b9 height=884366
2025-02-18T20:19:45Z UpdateTip: new best=000000000000000000019940b918fed6453c7afa80e03f1d837d1fdd8b31a8b9 height=884366 version=0x2002a000 log2_work=95.452620 tx=1156361979 date=&#39;2025-02-18T20:19:40Z&#39; progress=1.000000 cache=2.7MiB(19061txo)
</code></pre><p>Looking at the previous logs we can see that, although it is verifying very old blocks such as <code>210.000</code>, when a new block appears, <code>884.366</code> in this case, it immediately updates the tip of its chain and then continues with the verification of old blocks.</p>
<h2 id="conclusions-and-cautions">Conclusions and cautions<a hidden class="anchor" aria-hidden="true" href="#conclusions-and-cautions">#</a></h2>
<p>With this process the node reaches a state where it is usable to consult the balance and create transactions much faster than synchronizing the whole chain. In a normal laptop, this whole process has taken me no more than 2 hours which is already a big improvement compared to the days that a normal synchronization can take.</p>
<blockquote>
<p>&#x26a0;&#xfe0f; <strong>Warning</strong>.
<em>It is very important not to download the <strong>UTXO set</strong> from an unknown and untrusted source. The risk is very high, since a false representation of the <strong>UTXO set</strong> can make you believe that you have been paid when it is not true. <strong>You can be tricked and robbed</strong>.</em></p>
</blockquote>
<p>Bitcoin Core tries to prevent this by restricting the import of the <strong>UTXO set</strong> to a block defined in the latest release (the <code>880,000</code> block as of this post) and verifying that the <strong>UTXO set</strong> is correct and has not been tampered. Skipping this check is not difficult and allows more experienced users to speed up this process even more. This post will not explain how to do it so as not to expose the readers to a possible attack.</p>
<blockquote>
<p>&#x26a0;&#xfe0f; <strong>Warning</strong>.
<em>When the 1st part of the post was written the block of the last release was the <code>840.000</code> and not the <code>880.000</code>, that&rsquo;s why the guide is about the <code>840.000</code></em>.</p>
</blockquote>
<h2 id="how-to-create-or-obtain-a-backup-of-the-utxo-set">How to create or obtain a backup of the UTXO set?<a hidden class="anchor" aria-hidden="true" href="#how-to-create-or-obtain-a-backup-of-the-utxo-set">#</a></h2>
<p>The easiest way to get a backup of the <strong>UTXO set</strong> is with the magnet link: <code>magnet:?xt=urn:btih:559bd78170502971e15e97d7572e4c824f033492&amp;dn=utxo-880000.dat&amp;tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969</code>.</p>
<p>As I said before, you should avoid downloading the <strong>UTXO set</strong> from unknown sources (<strong>don&rsquo;t trust me!</strong>), but well, there are different mechanisms to verify that the copy provided by this magnet link is correct:</p>
<ul>
<li>The link provided in the <a href="https://github.com/bitcoin/bitcoin/pull/31969">PR Bitcoin Core</a> which introduces the parameters to the code.</li>
<li>You can validate the hash of the copy with: <code>shasum -a 256 utxo-880000.dat</code> the result should give <code>43b3b1ad6e1005ffc0ff49514d0ffcc3e3e3ce671cc8d02da7fa7bac5405f89de4</code>.</li>
</ul>
<h3 id="how-do-we-generate-our-own-backup">How do we generate our own backup?<a hidden class="anchor" aria-hidden="true" href="#how-do-we-generate-our-own-backup">#</a></h3>
<p>To do this we need a node already synchronized to a block height higher than the backup. In this case higher than <code>880.000</code>.</p>
<blockquote>
<p>&#x26a0;&#xfe0f; <strong>Warning</strong>.
<em>The node cannot be pruned at a lower height than the height of the block on which the backup is made.</em></p>
</blockquote>
<p>Using the instruction <code>bitcoin-cli -rpcclienttimeout=0 dumptxoutset utxo.dat rollback</code>. By default this command will backup the <strong>UTXO set</strong> to the <code>~\.bitcoin</code> directory. This process may take a little while, because the node is getting desynchronized until it reaches the block of the last valid checkpoint.</p>
<p><a href="https://x.com/sliv3r__/status/1891095297440280721">Here</a> you can see a video of how a node is being desynchronized in this process.</p>
<p>Again you can validate that the backup is correct with the hash of the file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>shasum -a <span style="color:#ae81ff">256</span> utxo-880000.dat
</span></span><span style="display:flex;"><span>43b3b1ad6e1005ffc0ff49514d0ffcc3e3ce671cc8d02da7fa7bac5405f89de4
</span></span></code></pre></div><p>Hey! Enjoy synchronizing nodes at the speed of light!!!
<img loading="lazy" src="/assumetxoutset/lightspeed.gif#center"></p>
<p><strong>AND REMEMBER &mdash;&gt; DON&rsquo;T TRUST, VERIFY. IF YOU DON&rsquo;T RUN YOUR OWN NODE YOU ARE NOT USING BITCOIN WITHOUT A &ldquo;TRUSTED&rdquo; MIDLEMAN</strong></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://pesvi.xyz/tags/nodes/">Nodes</a></li>
      <li><a href="https://pesvi.xyz/tags/bitcoincore/">BitcoinCore</a></li>
      <li><a href="https://pesvi.xyz/tags/layer-1/">Layer 1</a></li>
      <li><a href="https://pesvi.xyz/tags/bitcoin-cli/">Bitcoin-Cli</a></li>
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on x"
            href="https://x.com/intent/tweet/?text=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node&amp;url=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f&amp;hashtags=Nodes%2cBitcoinCore%2cLayer1%2cBitcoin-cli">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f&amp;title=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node&amp;summary=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node&amp;source=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f&title=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on whatsapp"
            href="https://api.whatsapp.com/send?text=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node%20-%20https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on telegram"
            href="https://telegram.me/share/url?text=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node&amp;url=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How the UTXO Set Can Help Us Synchronize a Bitcoin Node on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=How%20the%20UTXO%20Set%20Can%20Help%20Us%20Synchronize%20a%20Bitcoin%20Node&u=https%3a%2f%2fpesvi.xyz%2fposts%2futxo_set_backup%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://pesvi.xyz/">Explore Bitcoin and the Lightning Network</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
